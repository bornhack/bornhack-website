cache: pip

language: python
python:
  - "3.7"

services:
  - postgresql

addons:
  postgresql: "12"
  apt:
    packages:
    - postgresql-12-postgis-2.5

install:
  - pip install -r src/requirements/dev.txt

before_script:
  - psql -c "CREATE ROLE bornhack WITH CREATEDB LOGIN PASSWORD 'bornhack';"
  - psql -c "CREATE EXTENSION postgis;"

script:
  - cp src/bornhack/environment_settings.py.dist.dev src/bornhack/environment_settings.py
  - coverage run --source src/ src/manage.py test src/

after_success:
  - codecov
