{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block content %}
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Manage {{ team.name }} Team Permissions</h3>
    </div>
    <div class="card-body">
      <p>This view makes it possible to grant/revoke permissions for {{ team.name }} Team members. The <b>lead</b> and <b>member</b> permissions are granted through team memberships and can not be changed here.</p>
      <p>The available permissions are:</p>
      <dl>
        <dt>lead</dt>
        <dd>The team lead permission enables a user to manage team memberships and permissions. This permission is granted to and removed from team leads automatically when the team membership is updated. Codename <b>camps.{{ team.slug }}_team_lead</b>.</dd>
        <dt>member</dt>
        <dd>The team member permission grants access to the team area with tasks and the team guide. It also grants access to handle facility feedback in backoffice. Some sections of backoffice and the main site are restricted to users with this permission. Codename <b>camps.{{ team.slug }}_team_member</b>.</dd>
        <dt>mapper</dt>
        <dd>The team mapper permission grants access to gis/map layer management in backoffice. Codename <b>camps.{{ team.slug }}_team_mapper</b>.</dd>
        <dt>facilitator</dt>
        <dd>The team facilitator permission grants access to manage facilities in backoffice. Codename <b>camps.{{ team.slug }}_team_facilitator</b>.</dd>
        <dt>infopager</dt>
        <dd>The team infopager permission grants access to manage infopage sections for the team. Codename <b>camps.{{ team.slug }}_team_infopager</b>.</dd>
        <dt>pos</dt>
        <dd>The team pos permission grants access to submit point-of-sale reports on behalf of the team. Codename <b>camps.{{ team.slug }}_team_pos</b>.</dd>
        <p><a href="{% url 'backoffice:index' camp_slug=camp.slug %}" class="btn btn-secondary"><i class="fas fa-undo"></i> Backoffice</a></p>
        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <table class="table">
            <thead>
              <tr>
                <th>Username</th>
                <th>Name</th>
                <th>Public Credit Name</th>
                {% for perm in perms %}
                  <th class="text-center">{{ perm }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for member in team.approved_members.all %}
                <tr>
                  <td>{{ member.username }}</td>
                  <td>{{ member.profile.name }}</td>
                  <td>{{ member.profile.public_credit_name }}</td>
                  {% for perm in perms %}
                    {% for field in form.visible_fields %}
                      {% if field.name == member.username|add:"_"|add:perm %}
                        <td class="text-center">{{ field }}</td>
                      {% endif %}
                    {% endfor %}
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
          <button type="submit" class="btn btn-success"><i class="fas fa-check"></i> Save</button>
          <a href="{% url 'backoffice:team_permission_index' camp_slug=camp.slug %}" class="btn btn-secondary"><i class="fas fa-undo"></i> Cancel</a>
          <a href="{% url 'backoffice:index' camp_slug=camp.slug %}" class="btn btn-secondary"><i class="fas fa-undo"></i> Backoffice</a>
        </form>
      </div>
    </div>
{% endblock content %}
