{% extends 'base.html' %}
{% load leaflet_tags %}
{% load bootstrap3 %}
{% load static %}

{% block extra_head %}
  {{ form.media }}
  {% leaflet_css plugins="forms" %}
  {% leaflet_js plugins="forms" %}
  <script src="{% static 'js/mapVars.js' %}" type="text/javascript"></script>
  <script src="{% static 'js/map.js' %}" type="text/javascript"></script>
{% endblock extra_head %}

{% block content %}
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">{% if request.resolver_match.url_name == "facility_update" %}Update{% else %}Create new{% endif %} Facility</h3>
    </div>
    <div class="panel-body">
      <form method="POST">
        {% csrf_token %}
        {% bootstrap_form form %}
        {% buttons %}
          <button type="submit" class="btn btn-success"><i class="fas fa-check"></i> Save</button>
          <a href="{% url 'backoffice:facility_list' camp_slug=camp.slug %}" class="btn btn-default"><i class="fas fa-undo"></i> Cancel</a>
        {% endbuttons %}
      </form>
      <script>
        var mapObject = undefined;
        window.addEventListener("map:init", function (event) {
          var map = event.detail.map;
          mapObject = new BHMap(map);
          mapObject.loadLayer("{% static 'json/grid.geojson' %}", "Grid squares", {
            onEachFeature: mapObject.onEachGrid,
            style: {
              color: "gray",
              fillOpacity: 0.0,
              weight: 0.5
            },
          });
        });
      </script>
    </div>
  </div>
{% endblock content %}
